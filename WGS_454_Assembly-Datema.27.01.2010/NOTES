## NOTES: 

## Subject: [potgen] DM 454/clone end assembly for filling gaps
## Date: Thu, 28 Jan 2010 16:05:11 +0100
## From: "Datema, Erwin" <Erwin.Datema@wur.nl>
## To: <potato-genome@googlegroups.com>
##
## Dear all,
##

## I produced an assembly of the DM 454 and bac/fosmid end data that
## will hope fully aid us in filling some of the gaps that still
## remain in the current D M Illumina assembly. Dan Bolser will spend
## some time looking at these data, to see if they are of any use. A
## short discription of the data, as well as links to the data, can be
## found on the private wiki:
##
## https://secure.potatogenome.net/private_wiki/index.php/
##   Data/Assembly#DM_454.2Fclone-end_Assembly
##
## I will flesh out this page some more in the coming days. If you
## have any questions, please do not hesitate to contact me!

## Best,
## Erwin




## SSAHA (FAILS!)

SSAHA=/sw/local/src/dbolser/SSAHA/ssaha2

ASSEMBLY=../Assembly/PGSC0003DM/Indexes/PGSC0003DMB
QUERYSEQ=Data/DM_454_CE_Scaffolds.fna



## Construct the output file name from the inputs
OUT=`basename $ASSEMBLY`_vs_`basename $QUERYSEQ .fna`.ssaha


$SSAHA -tags 0 \
 -save $ASSEMBLY.sanger $QUERYSEQ \
 | perl -ne '
     print if /^\d/
   ' \
 > Results/$OUT



## Replace the whitespace field terminators with tabs (for loading the
## raw data into mysql) ... later we will generate GFF format output.

sed -ri 's/\s+/\t/g' Results/$OUT



## DFILT

~/BiO/Util/depth_filter.plx \
  Results/$OUT \
> Results/$OUT.dfilt





## A2A MAPPER


POT_ASSEMBLY_ILU=Assembly/PGSC0003DM/PGSC0003DMB.fa
POT_ASSEMBLY_454=Data/DM_454_CE_Scaffolds.fna

ATACDIR=$HOME/build/ATAC

GENOMEDIR=$TMPDIR/dbolser/ATAC/ILU_vs_454

mkdir -p $GENOMEDIR

## DUMB PROGRAM!
$ATACDIR/bin/leaff -f $POT_ASSEMBLY_ILU -W > $GENOMEDIR/`basename $POT_ASSEMBLY_ILU`
$ATACDIR/bin/leaff -f $POT_ASSEMBLY_454 -W > $GENOMEDIR/`basename $POT_ASSEMBLY_454`



## GO
perl $ATACDIR/bin/atac.pl \
  -meryldir  $GENOMEDIR/meryl \
  -dir       $GENOMEDIR \
  -id1 ILU -seq1 $GENOMEDIR/`basename $POT_ASSEMBLY_ILU` \
  -id2 454 -seq2 $GENOMEDIR/`basename $POT_ASSEMBLY_454`



## The important results file is:
CLUMPS=ILUvs454.ref\=ILU.clumpCost\=5000.atac.uids

## Put it safe
mv $GENOMEDIR/$CLUMPS Results

grep -c 'M c ' Results/$CLUMPS



## GFF3 it

./make_GFF.plx \
  --source 'WGS_454_Assembly-Datema.27.01.2010' \
  Results/$CLUMPS \
> Results/a2a.gff




## LOAD!

bp_seqfeature_load.pl -f -v -z \
  --dsn dbi:mysql:www-potato:mysql.compbio.dundee.ac.uk \
  --user www-potato \
  --pass abc123 \
Results/a2a.gff





